---
SPDX-License-Identifier: MIT
path: "/tutorials/encrypted-and-automated-backups-with-restic"
slug: "encrypted-and-automated-backups-with-restic"
date: "2024-01-20"
title: "Encrypted and automated backups with restic"
short_description: "This tutorial will show you how to create encrypted, local, and remote backups of your server data, and how to automate their execution."
tags: ["Backups", "Server", "restic"]
author: "Benoît Benedetti"
author_link: "https://github.com/humboldtux"
author_img: "https://avatars.githubusercontent.com/u/65201"
author_description: ""
language: "fr"
available_languages: ["en", "fr"]
header_img: "header-2"
cta: "cloud"
---

## Introduction

The importance of a good backup strategy for your server data cannot be
overstated. [restic](https://restic.net/) is a command-line tool that is
easy to use, fast, efficient due to deduplication, and secure through backup
encryption. In this tutorial, we will explore how to back up your server
data with Restic, as well as how to manage the configuration and scheduling
of your backup strategies using the third-party tool [resticprofile](https://creativeprojects.github.io/resticprofile/).

**Prerequisites**

To follow this tutorial, you will need to have basic command-line skills
under Linux. Our reference distribution will be Debian 12. Since restic is
cross-platform and available in the official repositories of the most common
distributions, you should have no trouble replicating the commands provided
for your system.

## Step 1 - Installing restic

In this step, we will install Restic.

The tool is available in the official repositories of Debian 12, easily installable via apt :

```shell
# sudo apt install -y restic
```

The version available under Debian 12 is 0.14. You can follow this article with any version >= 0.14.
The latest stable version of Restic at the time of writing this tutorial is version 0.16.

## Step 2 - Repository Initialization

To store backups, restic requires a repository:
a folder containing the backups, as well as encryption keys
and other repository-specific metadata.

You must start by initializing a folder, existing or not,
as a repository before you can use it to store backups.
This is done with the `init` command by specifying
the desired folder as the repository with the `--repo` option:

```shell
# sudo restic init --repo /srv/restic-repo
enter password for new repository:
enter password again:
created restic repository ff3b09b0ad at /srv/restic-repo

Please note that knowledge of your password is required to access
the repository. Losing your password means that your data is
irrecoverably lost.
The initialization prompts for the password to protect this repository, which will be required for all future uses of it and to access its backups: make sure to note it down!
```

Any user can have as many repositories as they see fit.
Here, I used `sudo` and a folder located in `/srv`
because our example repository in this tutorial will store sensitive data,
only accessible by a privileged user.

But any user, even non-privileged, can certainly initialize
and use one or more repositories, provided they have write permissions
on the repository folder, as well as on the files
and folders they intend to back up. For example:

```shell
# restic init --repo ~/restic-repo
enter password for new repository:
enter password again:
created restic repository 972caa3fcf at /home/testing/restic-repo

Please note that knowledge of your password is required to access
the repository. Losing your password means that your data is
irrecoverably lost.
```

## Step 3 - Data Backup

To back up data, we specify the repository to use again with the `--repo` option,
or `-r` for short. We use the backup command,
to which we pass the file(s) and folder(s) we want to back up :

```shell
# sudo restic -r /srv/restic-repo backup /etc /root

enter password for repository:
repository ff3b09b0 opened (repository version 2) successfully, password is correct
created new cache in /root/.cache/restic
no parent snapshot found, will read all files

Files: 3152 new, 0 changed, 0 unmodified
Dirs: 1151 new, 0 changed, 0 unmodified
Added to the repository: 34.715 MiB (12.498 MiB stored)

processed 3152 files, 33.217 MiB in 0:00
snapshot f16118a4 saved
```

Here, Restic has created a snapshot, uniquely identified by the ID f16118a4.
This snapshot contains the backup of the requested files and folders,
for a total of nearly 35 MiB actual, but only requiring less than 13 MiB
in the repository, as Restic detected data deduplication
and utilized it to reduce the snapshot size.

This deduplication becomes even more useful during subsequent backups,
as demonstrated when files and folders are exactly identical
during the re-execution of the previous backup command :

```shell
# sudo restic --repo /srv/restic-repo backup /etc /root

enter password for repository:
repository ff3b09b0 opened (repository version 2) successfully, password is correct
using parent snapshot f16118a4

Files: 0 new, 0 changed, 3152 unmodified
Dirs: 0 new, 0 changed, 1151 unmodified
Added to the repository: 0 B (0 B stored)

processed 3152 files, 33.217 MiB in 0:00
snapshot 2f0c01ad saved
```

A new snapshot is created as requested, with no new files or folders detected.
The snapshot will always have the same size of 33 MiB when restored,
but thanks to deduplication, the actual size of the repository
has (almost) not changed :

```shell
# sudo du -sh /srv/restic-repo/
14M     /srv/restic-repo/
```

## Step X - Installing resticprofile

In this step, we will install resticprofile.
The tool is not available in the Debian repositories, so we will use the official
installation script to install it in the /usr/local/bin directory :

```shell
# curl -sfL https://raw.githubusercontent.com/creativeprojects/resticprofile/master/install.sh | sudo sh -s -- -b /usr/local/bin
```

The latest version of resticprofile at the time of writing this tutorial is version 0.24 :

```shell
# resticprofile version
resticprofile version 0.24.0 commit bcfaaa7cacfa7f88a94d5dc62ca69b2d89205d8
```

resticprofile has many commands and sub-commands, logically analogous and inherited from restic.
To facilitate its usage, restic has a generate command to generate completions for Bash and Zsh shells.
Here is the command to automatically activate these completions when starting a Bash shell :

```shell
# resticprofile generate --bash-completion | sudo tee  /etc/bash_completion.d/resticprofile
# sudo chmod +x /etc/bash_completion.d/resticprofile
```

Don't forget to log out and restart your shell for these new completions to take effect.

## Conclusion

Et voilà! You have now set up an encrypted, automated local and remote backup strategy using restic and resticprofile.

##### License: MIT

<!--

Contributor's Certificate of Origin

By making a contribution to this project, I certify that:

(a) The contribution was created in whole or in part by me and I have
    the right to submit it under the license indicated in the file; or

(b) The contribution is based upon previous work that, to the best of my
    knowledge, is covered under an appropriate license and I have the
    right under that license to submit that work with modifications,
    whether created in whole or in part by me, under the same license
    (unless I am permitted to submit under a different license), as
    indicated in the file; or

(c) The contribution was provided directly to me by some other person
    who certified (a), (b) or (c) and I have not modified it.

(d) I understand and agree that this project and the contribution are
    public and that a record of the contribution (including all personal
    information I submit with it, including my sign-off) is maintained
    indefinitely and may be redistributed consistent with this project
    or the license(s) involved.

Signed-off-by: Benoît Benedetti <humboldtux@gmail.com>

-->
